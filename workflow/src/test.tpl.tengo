// get preset

self := import("@platforma-sdk/workflow-tengo:tpl")
smart := import("@platforma-sdk/workflow-tengo:smart")
ll := import("@platforma-sdk/workflow-tengo:ll")
exec := import("@platforma-sdk/workflow-tengo:exec")
assets := import("@platforma-sdk/workflow-tengo:assets")

self.validateInputs({
	"__options__,closed": "",
	csvCovariates: "any",
	params: {
		"__options__,closed": "",
		"species,omitempty": "string"
	}
})

self.awaitState("csvCovariates", "ResourceReady")
self.defineOutputs("wetherContinue")

self.body(func(inputs) {
	// Check if metadata matrix is full rank
	continueCheck := exec.builder().
			software(assets.importSoftware("@platforma-open/milaboratories.run-deseq2-r.software:prev-checks")).
			arg("--output").arg(".").
			arg("--metadata").arg("covariates.csv").
			addFile("covariates.csv", inputs.csvCovariates).
			saveFile("continueOrNot.txt").
			printErrStreamToStdout().
			saveStdoutContent().
			cache(24 * 60 * 60 * 1000).
			run()
			
	wetherContinue := continueCheck.getFileContent("continueOrNot.txt")
	
	

	return {
		wetherContinue: wetherContinue
	}
})
